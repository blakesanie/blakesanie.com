---
import PhotographyPage from "./index.astro";
import exiftoolJson from "../../../photo-portfolio/metadata.json";

function removeAccents(str) {
  // Normalize the string to NFD and remove diacritical marks
  return str.normalize("NFD").replace(/\p{Diacritic}/gu, "");
}

function splitByNonAlphanumeric(s) {
  // Split by non-alphanumeric characters
  return s.split(/[^a-zA-Z0-9]+/);
}

export async function getStaticPaths() {
  const glob = await import.meta.glob("/photo-portfolio/portfolio2k/*");
  const out = (
    await Promise.all(
      Object.keys(glob).map(async (path) => {
        const filename = path.split("/").pop();
        const upperCamel = filename.split(".").slice(0, -1).join(".");

        const meta = exiftoolJson[filename];
        const title = decodeURIComponent(
          meta["File Name"]
            .split(".")
            .slice(0, -1)
            .join(".")
            .replaceAll("_", " ")
        );

        return [
          {
            params: {
              slug: upperCamel,
            },
            props: {
              title: title,
              image: path,
            },
          },
          {
            params: {
              slug: "map/" + upperCamel,
            },
            props: {
              title: title,
              image: path,
              initialMode: "map",
            },
          },
        ];
      })
    )
  ).flat();
  console.log;
  return out;
}
---

<PhotographyPage
  image={Astro.props.image}
  imageName={Astro.props.title}
  initialMode={Astro.props.initialMode}
/>
