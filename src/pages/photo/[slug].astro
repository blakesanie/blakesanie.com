---
import PortfolioPage from "./index.astro";
import exiftoolJson from "../../../photo-portfolio/temp/blake/metadata.json";

export async function getStaticPaths() {
  const glob = await import.meta.glob("/photo-portfolio/temp/blake/*");
  return (
    await Promise.all(
      Object.keys(glob)
        .filter((path) => path.endsWith(".jpg"))
        .map(async (path) => {
          const filename = path.split("/").pop();
          const name = filename?.split(".").slice(0, -1).join(".");
          if (!name) throw new Error(`No filename found for path: ${path}`);
          console.log("name is", name);
          const meta = exiftoolJson[name];
          if (!meta) throw new Error(`No metadata found for ${filename}`);

          const title = decodeURIComponent(
            meta["File Name"]
              .split(".")
              .slice(0, -1)
              .join(".")
              .replaceAll("_", " "),
          );

          return [
            {
              params: {
                slug: name,
              },
              props: {
                image: path,
                imageName: title,
              },
            },
          ];
        }),
    )
  ).flat();
}
---

<PortfolioPage image={Astro.props.image} imageName={Astro.props.imageName} />
